# rtl_gen

## 关于张量表达式的生成和资源自动分配

### 在知道资源数量后，首先进行一次简单的分配
此时假设只进行方阵计算
对于矩阵A，设希望提供的带宽为$8n$，则：
当$n<=64$时，A和B各需要n块BRAM
从1开始遍历n
A，B各占用n块bram。A的数据量为$(8n)^2=64n^2Bytes$，则C的数据量为A的4倍，即$256n^2Bytes$。需要的bram数量为$256n^2B/36kb=256n^2B/4.5kB=256n^2/4608=ceil(n^2/18)$块
当$n>64\ and\ n<=128$时，由于深度超过了单块bram的极限512，所以矩阵的每8列都需要2块bram。即便把所有列合在一起申请也是一样，因为为了保证带宽，就没法利用每块里空闲的空间。所以A和B各需要2n块BRAM。C不变

综上：
A和B各需要的bram数为：
$$ceil(n/64)\times n$$
C需要的bram数为：
$$ceil(n^2/18)$$
按照
$$A+B+C<=[0.9*Total]$$
找到第一次决定的n
然后根据n判断计算资源是否足够
如果不够，则从n至1遍历，知道找到合适的n

### 根据简单分配的结果，将计算图拆分为张量计算
